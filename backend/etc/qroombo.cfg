*** GENERAL ***
admin = tobi@oetiker.ch doris@oetiker.ch
secret = very_secret_cookie_secret
log_file = /tmp/qroombo.log
log_level = debug
database_dir = /tmp/qroombo

*** MAIL ***
smtp_server = johan.oetiker.ch
sender = tobi@oetiker.ch
+KEYMAIL
From: Tobi Oetiker <tobi@oetiker.ch>
To: {TO}
Subject: Qroombo Key

You Qroobo key is {KEY}

*** RESERVATION ***
first_hour = 7
last_hour = 23

+EXTRA_FIELDS_PL
[
  {
    key => 'horytarif',
    label => 'Horyzon Tarif',
    widget => 'checkBox',
    set => {
        label => '+1 CHF pro Mietstunde zu gunsten von Horyzon',        
    }
  },
  {
    key => 'tarif',
    label => 'Tarif',
    widget => 'selectBox',
  }
]

+SELECTBOX_CFG_PL
my $ret = [
    { key => 'noprof', title => 'Non Profit Tarif' },
    { key => 'normal', title => 'Normaltarif' },     
];
if ($D{addr}{allow_free}){
      unshift @$ret, { key => 'free', title => 'Gratis Nutzung' };   
}

return {
      tarif => $ret
};

*** USER ***
+EXTRA_FIELDS_PL

*** ADDRESS ***

+EXTRA_FIELDS_PL
[  
  {
    key => 'allow_free',
    label => 'Gratis',
    widget => 'checkBox',
    set => {
        label => 'Gratis Miete erlauben',
    },
    write => 'admin'
  }
]

*** ROOM ***
+PRICE_PL
if ($D{addr}{allow_free} and $D{resv}{tarif} eq 'free'){
    return 0;
}
my $price = $D{resv}{resv_len} * $D{room}{price_norm};
$price = $D{room}{price_min} if $price < $D{room}{price_min};
if ($D{resv}{tarif} eq 'noprof'){
    $price = $D{resv}{resv_len} * $D{room}{prive_noprof};
    $price = $D{room}{price_noprof_min} if $price < $D{room}{price_noprof_min};
}
return $price;

*** ROOM:salon ***
name = Salon
m_2 = 65
description = Grosser Raum mit Garten Zugang

+DATA_PL
return { 
   price_norm => 15,
   price_noprof => 25, 
   price_min => 50,
   price_noprof_min => 20
}

*** ROOM:sitz ***
name = Sitzungszimmer
m_2 = 12
description = Kleiner Besprechungsraum

+DATA_PL
return { 
   price_norm => 20,
   price_noprof => 35,
   price_min => 50,
   price_noprof_min => 20
}

